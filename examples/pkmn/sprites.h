#pragma once

const byte PLAYER_SPRITE_0[8] = {
    0x0C, 0x1E, 0x1E, 0x0C, 0x1E, 0x1E, 0x0C, 0x0C,
};

const byte PLAYER_SPRITE_1[8] = {
    0x0C, 0x1E, 0x1E, 0x0C, 0x1E, 0x1E, 0x14, 0x22,
};

const byte PLAYER_COLORS[8] = {
    COL_BROWN, COL_BROWN, COL_CREAM,     COL_CREAM,
    COL_RED,   COL_RED,   COL_UI_BORDER, COL_UI_BORDER,
};

void drawPlayer(short px, short py) {
    short row, screenY, fbRowBase, fbIdx;
    byte bits, color;
    short pxBase = (px & 0xFFFF) >> 1; // jcc:ignore-sign-extension

    for (row = 0; row < 8; row++) {
        bits = (anim_frame == 0) ? PLAYER_SPRITE_0[row] : PLAYER_SPRITE_1[row];
        color = PLAYER_COLORS[row];
        screenY = py + row;
        fbRowBase = (screenY << 4) + (screenY << 3);

        if ((bits & 0xFF) & 0x20)
            setPixel(px, screenY, color);
        if ((bits & 0xFF) & 0x10)
            setPixel(px + 1, screenY, color);
        if ((bits & 0xFF) & 0x08)
            setPixel(px + 2, screenY, color);
        if ((bits & 0xFF) & 0x04)
            setPixel(px + 3, screenY, color);
        if ((bits & 0xFF) & 0x02)
            setPixel(px + 4, screenY, color);
        if ((bits & 0xFF) & 0x01)
            setPixel(px + 5, screenY, color);
    }
}

// F=transparent, 0=black, 1=white, A=red
const byte VOLTORB_SPRITE_0[98] = {
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xAA, 0xAA,
    0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0xAA, 0xAA, 0xA0, 0xFF, 0xFF, 0xF0,
    0xAA, 0xAA, 0xAA, 0xAA, 0x0F, 0xFF, 0x0A, 0xAA, 0xAA, 0xAA, 0xAA,
    0xA0, 0xFF, 0x0A, 0xAA, 0xAA, 0xAA, 0xAA, 0xA0, 0xFF, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFF, 0x01, 0x11, 0x11, 0x11, 0x11, 0x10,
    0xFF, 0x01, 0x11, 0x11, 0x11, 0x11, 0x10, 0xFF, 0xF0, 0x11, 0x11,
    0x11, 0x11, 0x0F, 0xFF, 0xFF, 0x01, 0x11, 0x11, 0x10, 0xFF, 0xFF,
    0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
};

const byte VOLTORB_SPRITE_1[98] = {
    0xFF, 0xFF, 0xAA, 0xAA, 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0xAA, 0xAA,
    0xA0, 0xFF, 0xFF, 0xF0, 0xAA, 0xAA, 0xAA, 0xAA, 0x0F, 0xFF, 0x0A,
    0xAA, 0xAA, 0xAA, 0xAA, 0xA0, 0xFF, 0x0A, 0xAA, 0xAA, 0xAA, 0xAA,
    0xA0, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x01, 0x11,
    0x11, 0x11, 0x11, 0x10, 0xFF, 0x01, 0x11, 0x11, 0x11, 0x11, 0x10,
    0xFF, 0xF0, 0x11, 0x11, 0x11, 0x11, 0x0F, 0xFF, 0xFF, 0x01, 0x11,
    0x11, 0x10, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
};

// 0=transparent, 8=yellow, 9=brown, A=red
const byte PIKACHU_SPRITE_0[98] = {
    0x00, 0x09, 0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x98, 0x00, 0x00,
    0x08, 0x90, 0x00, 0x09, 0x88, 0x08, 0x80, 0x88, 0x89, 0x00, 0x08,
    0x88, 0x88, 0x88, 0x88, 0x80, 0x00, 0x08, 0x80, 0x88, 0x88, 0x08,
    0x80, 0x00, 0x08, 0xA8, 0x88, 0x88, 0x8A, 0x80, 0x00, 0x00, 0x88,
    0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00,
    0x00, 0x08, 0x88, 0x88, 0x88, 0x88, 0x80, 0x00, 0x00, 0x88, 0x88,
    0x88, 0x88, 0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00,
    0x00, 0x88, 0x08, 0x80, 0x88, 0x88, 0x00, 0x00, 0x88, 0x08, 0x80,
    0x88, 0x88, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x00,
};

const byte PIKACHU_SPRITE_1[98] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00,
    0x00, 0x90, 0x00, 0x00, 0x98, 0x00, 0x00, 0x08, 0x90, 0x00, 0x09,
    0x88, 0x08, 0x80, 0x88, 0x89, 0x00, 0x08, 0x88, 0x88, 0x88, 0x88,
    0x80, 0x00, 0x08, 0x80, 0x88, 0x88, 0x08, 0x80, 0x00, 0x08, 0xA8,
    0x88, 0x88, 0x8A, 0x80, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00,
    0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x08, 0x88, 0x88,
    0x88, 0x88, 0x80, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00,
    0x00, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x88, 0x08, 0x80,
    0x88, 0x88, 0x00, 0x00, 0x88, 0x08, 0x80, 0x88, 0x88, 0x80,
};

// px must be even
void drawVoltorb(short px, short py) {
    short row, col, spriteIdx, rowBase, screenY, fbRowBase, fbIdx;
    byte packedByte, leftPixel, rightPixel, fbByte;
    short pxHalf = (px & 0xFFFF) >> 1; // jcc:ignore-sign-extension

    for (row = 0; row < 14; row++) {
        rowBase = (row << 3) - row;
        screenY = py + row;
        fbRowBase = (screenY << 4) + (screenY << 3);

        for (col = 0; col < 7; col++) {
            spriteIdx = rowBase + col;
            packedByte = (anim_frame == 0) ? VOLTORB_SPRITE_0[spriteIdx]
                                           : VOLTORB_SPRITE_1[spriteIdx];

            if (packedByte == (byte)0xFF)
                continue;

            fbIdx = fbRowBase + pxHalf + col;
            leftPixel =
                ((packedByte & 0xFF) >> 4) & 0x0F; // jcc:ignore-sign-extension
            rightPixel = packedByte & 0x0F;

            fbByte = framebuffer[fbIdx];
            if (leftPixel != 0x0F) {
                fbByte = (byte)((fbByte & 0x0F) |
                                (leftPixel << 4)); // jcc:ignore-sign-extension
            }
            if (rightPixel != 0x0F) {
                fbByte = (byte)((fbByte & 0xF0) |
                                rightPixel); // jcc:ignore-sign-extension
            }
            framebuffer[fbIdx] = fbByte;
        }
    }
}

// px must be even
void drawPikachu(short px, short py) {
    short row, col, spriteIdx, rowBase, screenY, fbRowBase, fbIdx;
    byte packedByte, leftPixel, rightPixel, fbByte;
    short pxHalf = (px & 0xFFFF) >> 1; // jcc:ignore-sign-extension

    for (row = 0; row < 14; row++) {
        rowBase = (row << 3) - row;
        screenY = py + row;
        fbRowBase = (screenY << 4) + (screenY << 3);

        for (col = 0; col < 7; col++) {
            spriteIdx = rowBase + col;
            packedByte = (anim_frame == 0) ? PIKACHU_SPRITE_0[spriteIdx]
                                           : PIKACHU_SPRITE_1[spriteIdx];

            if (packedByte == 0x00)
                continue;

            fbIdx = fbRowBase + pxHalf + col;
            leftPixel =
                ((packedByte & 0xFF) >> 4) & 0x0F; // jcc:ignore-sign-extension
            rightPixel = packedByte & 0x0F;

            fbByte = framebuffer[fbIdx];
            if (leftPixel != 0) {
                fbByte = (byte)((fbByte & 0x0F) |
                                (leftPixel << 4)); // jcc:ignore-sign-extension
            }
            if (rightPixel != 0) {
                fbByte = (byte)((fbByte & 0xF0) |
                                rightPixel); // jcc:ignore-sign-extension
            }
            framebuffer[fbIdx] = fbByte;
        }
    }
}
